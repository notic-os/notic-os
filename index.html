<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Helpdesk Ticket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="/assets/tailwind.css" rel="stylesheet" />
</head>

<body class="p-4">

  <div class="bg-white shadow-lg rounded-xl p-4 pt-2 w-full max-w-4xl transition-opacity" id="formCard">
    <h2 class="text-xl font-semibold mb-4 text-gray-800">Submit a Ticket</h2>

    <form id="ticketForm" class="space-y-4">

      <div class="flex flex-col md:flex-row gap-4">
        <div class="md:w-1/3">
          <label class="text-sm font-medium text-gray-700">Name</label>
          <input 
            type="text" 
            name="name" 
            required 
            class="w-full mt-1 p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <div class="md:flex-1">
          <label class="text-sm font-medium text-gray-700">Issue</label>
          <textarea 
            name="issue" 
            rows="3" 
            required 
            class="w-full mt-1 p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>
      </div>

      <button 
        type="submit" 
        class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-60"
      >
        Submit Ticket
      </button>

    </form>

    <div id="response" class="hidden opacity-0 text-green-700 font-semibold text-center pt-2 transition-opacity"></div>
  </div>

<script>
  const form = document.getElementById('ticketForm');
  const responseEl = document.getElementById('response');
  const title = document.querySelector("h2");

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const btn = form.querySelector("button");
    btn.disabled = true;
    btn.innerText = "Submitting...";

    const data = {
      name: form.name.value,
      issue: form.issue.value
    };

    try {
      const res = await fetch('/submit', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data)
      });

      const result = await res.json();

      form.style.opacity = "0";
      setTimeout(() => {
        form.classList.add("hidden");
        if (title) title.textContent = "Success!";
        responseEl.classList.remove("hidden");
        responseEl.innerText = result.message;
        responseEl.style.opacity = "1";
      }, 250);

    } catch (err) {
      btn.disabled = false;
      btn.innerText = "Submit Ticket";
      alert("There was a problem submitting your ticket.");
    }
  });
</script>

</body>
</html>
